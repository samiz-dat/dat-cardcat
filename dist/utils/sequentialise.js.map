{"version":3,"sources":["../../src/utils/sequentialise.js"],"names":["sequentialise","obj","opts","P","promise","Promise","ignore","Array","isArray","queue","execute","queryFn","queueOptions","resolve","add","handler","get","target","propKey","receiver","origMethod","includes","args","length","pop","undefined","bind","Proxy"],"mappings":";;;;;;;;;;;;;;;;;;;;;AAqBwBA,a,CArBxB,8C,yJAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEe,SAASA,aAAT,CAAuBC,GAAvB,EAA4BC,IAA5B,EAAkC,CAC/C,MAAMC,IAAKD,QAAQA,KAAKE,OAAd,GAAyBF,KAAKE,OAA9B,GAAwCC,OAAlD,CACA,MAAMC,SAAUJ,QAAQK,MAAMC,OAAN,CAAcN,KAAKI,MAAnB,CAAT,GAAuCJ,KAAKI,MAA5C,GAAqD,EAApE,CAEA,MAAMG,QAAQ,4BAAd,CAEA,SAASC,OAAT,CAAiBC,OAAjB,EAA0BC,YAA1B,EAAwC,CACtC,OAAO,IAAIT,CAAJ,CAAMU,WAAWJ,MAAMK,GAAN,CAAUH,OAAV,EAAmBE,OAAnB,EAA4BD,YAA5B,CAAjB,CAAP,CACD,CACD,MAAMG,UAAU,EACdC,IAAIC,MAAJ,EAAYC,OAAZ,EAAqBC,QAArB,EAA+B,CAC7B,MAAMC,aAAaH,OAAOC,OAAP,CAAnB,CACA,IAAI,OAAOE,UAAP,KAAsB,UAAtB,IAAqCd,OAAOe,QAAP,CAAgBH,OAAhB,CAAzC,EAAoE,OAAOE,UAAP,CACpE,OAAO,CAAC,GAAGE,IAAJ,KAAa,CAClB,MAAMV,eAAgBU,KAAKC,MAAL,GAAcH,WAAWG,MAA1B,GAAoCD,KAAKE,GAAL,EAApC,GAAiDC,SAAtE,CACA,OAAOf,QAAQU,WAAWM,IAAX,CAAgBP,QAAhB,EAA0B,GAAGG,IAA7B,CAAR,EAA4CV,YAA5C,CAAP,CACD,CAHD,CAID,CARa,EAAhB;;AAUA,SAAO,IAAIe,KAAJ,CAAU1B,GAAV,EAAec,OAAf,CAAP;AACD","file":"sequentialise.js","sourcesContent":["import PromiseQueue from './PromiseQueue';\n\n// export class Sequentialise {\n//   constructor(object) {\n//     this.queue = new PromiseQueue();\n//     for (const key of object) {\n//       const fn = object[key];\n//       if (typeof fn === 'function' && Object.prototype.hasOwnProperty.call(object, key)) {\n//         this[key] = (...args) => {\n//           const opts = (args.length > fn.length) ? args.pop() : undefined;\n//           return this.execute(fn.bind(object, ...args), opts);\n//         };\n//       }\n//     }\n//   }\n\n//   execute(queryFn, opts) {\n//     return new Promise(resolve => this.queue.add(queryFn, resolve, opts));\n//   }\n// }\n\nexport default function sequentialise(obj, opts) {\n  const P = (opts && opts.promise) ? opts.promise : Promise;\n  const ignore = (opts && Array.isArray(opts.ignore)) ? opts.ignore : [];\n\n  const queue = new PromiseQueue();\n\n  function execute(queryFn, queueOptions) {\n    return new P(resolve => queue.add(queryFn, resolve, queueOptions));\n  }\n  const handler = {\n    get(target, propKey, receiver) {\n      const origMethod = target[propKey];\n      if (typeof origMethod !== 'function' || (ignore.includes(propKey))) return origMethod;\n      return (...args) => {\n        const queueOptions = (args.length > origMethod.length) ? args.pop() : undefined;\n        return execute(origMethod.bind(receiver, ...args), queueOptions);\n      };\n    },\n  };\n  return new Proxy(obj, handler);\n}\n"]}